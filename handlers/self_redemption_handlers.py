from aiogram import types
from aiogram.dispatcher import FSMContext  # –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
from loguru import logger

from keyboards.user_keyboards import keyboard_to_main_menu
from system.dispatcher import bot, dp


@dp.callback_query_handler(lambda c: c.data == "self_redemption")
async def self_redemption(callback_query: types.CallbackQuery, state: FSMContext):
    """üõç –°–∞–º–æ–≤—ã–∫—É–ø"""
    try:
        await state.finish()  # –ó–∞–≤–µ—Ä—à–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—à–∏–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
        await state.reset_state()  # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –º–∞—à–∏–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π, –¥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        greeting_message = (f"–†–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç 20 –∫–≥!\n\n"
                            
                            f"‚Ä¢ –ù–∏–∫–∞–∫–∏—Ö –∫–æ–º–∏—Å—Å–∏–π –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏ –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—é –Ω–∞ —Å–∫–ª–∞–¥–µ –º—ã –Ω–µ –±–µ—Ä–µ–º.\n"
                            f"‚Ä¢ –í—ã —Å–∞–º–∏ –Ω–∞—à–ª–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞, –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –æ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–µ, —É–∑–Ω–∞–ª–∏ —É –Ω–∞—Å –∞–¥—Ä–µ—Å –∏ –∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞, –æ–ø–ª–∞—Ç–∏–ª–∏ —Ç–æ–≤–∞—Ä, –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –Ω–∞ –Ω–∞—à —Å–∫–ª–∞–¥.\n\n"

                            f"‚Ä¢ –ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≥—Ä—É–∑–∞ –Ω–∞ –Ω–∞—à —Å–∫–ª–∞–¥, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–º–∞—Ä–∫–∏—Ä–æ–≤–∞—Ç—å –≥—Ä—É–∑ –∫–æ–¥–æ–º –∫–ª–∏–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –º—ã –≤–∞–º –ø—Ä–∏—Å–≤–æ–∏–º, –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –Ω—É–∂–Ω–∞ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≥—Ä—É–∑–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ. –ì—Ä—É–∑—ã –ø—Ä–∏—à–µ–¥—à–∏–µ –±–µ–∑ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã, –∏ –º–æ–≥—É—Ç –Ω–µ —É–µ—Ö–∞—Ç—å –≤ –†–æ—Å—Å–∏—é.\n"
                            f"‚Ä¢ –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º –≥—Ä—É–∑–∞ –Ω–∞ –Ω–∞—à —Å–∫–ª–∞–¥, –∫–ª–∏–µ–Ω—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ç—Ä–µ–∫ –Ω–æ–º–µ—Ä–∞ –∏ –ø—Ä–∏—Ö–æ–¥ —Ç–æ–≤–∞—Ä–∞ –∫ –Ω–∞–º –Ω–∞ —Å–∫–ª–∞–¥, –∫–æ–≥–¥–∞ –≤—Å–µ —Ç—Ä–µ–∫ –Ω–æ–º–µ—Ä–∞ –¥–æ—à–ª–∏ –∫ –Ω–∞–º –Ω–∞ —Å–∫–ª–∞–¥, –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –æ–± —ç—Ç–æ–º –∏ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫ –Ω–æ–º–µ—Ä–æ–≤ –¥–ª—è —Å–≤–µ—Ä–∫–∏, —Ç–∞–∫–∂–µ –Ω–∞ –Ω–∞—à–µ–º —Å–∫–ª–∞–¥–µ –≤–µ–¥–µ—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —É—á–µ—Ç —Ç—Ä–µ–∫ –Ω–æ–º–µ—Ä–æ–≤ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º, –º—ã —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤ —Ç–∞–±–ª–∏—Ü–µ –∫–∞–∂–¥—ã–π —Ç—Ä–µ–∫ –Ω–æ–º–µ—Ä –ø—Ä–∏—à–µ–¥—à–∏–π –Ω–∞ —Å–∫–ª–∞–¥, –º—ã —Å–≤–µ—Ä—è–µ–º —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö —Ç—Ä–µ–∫–æ–≤ —Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏—à–µ–¥—à–∏–º–∏ –Ω–∞ —Å–∫–ª–∞–¥, –¥–µ–ª–∞–µ–º –¥–ª—è –≤–∞—Å –æ–±—â—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –≥—Ä—É–∑–∞, —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã —É–ø–∞–∫–æ–≤–∫–∏.\n\n"

                            f"‚Ä¢ –ü–æ—Å–ª–µ —É–ø–∞–∫–æ–≤–∫–∏, –≥—Ä—É–∑ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –†–æ—Å—Å–∏—é.\n\n"

                            f"–ï—Å–ª–∏ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ, –º—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—É—é —É—Å–ª—É–≥—É, —Å—Ç–æ–∏–º–æ—Å—Ç—å 1¬• –∑–∞ —Å—á–µ—Ç–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É.\n\n"

                            f"–¢–∞–∫ –∂–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –±—Ä–∞–∫, —Å—Ç–æ–∏–º–æ—Å—Ç—å 1-3¬• –∑–∞ —Å—á–µ—Ç–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∏–¥–∞ –∏ —É–ø–∞–∫–æ–≤–∫–∏ —Ç–æ–≤–∞—Ä–∞)\n\n"

                            f"–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏: @cargo_cfb")
        main_menu_keyboard = keyboard_to_main_menu()
        await bot.send_message(callback_query.from_user.id,  # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                               text=greeting_message,  # –¢–µ–∫—Å—Ç –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è üëã
                               reply_markup=main_menu_keyboard,
                               parse_mode=types.ParseMode.HTML)  # –¢–µ–∫—Å—Ç –≤ HTML-—Ä–∞–∑–º–µ—Ç–∫–∏
    except Exception as error:
        logger.exception(error)


def register_self_redemption_handler():
    """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º handlers –¥–ª—è –±–æ—Ç–∞"""
    dp.register_message_handler(self_redemption)